{% extends "base.html" %}
{% load static %}
{% block title%} SubAdmin {% endblock%}

{% block nav_title %}
    {% with page_title="SubAdmin Management" %}
        {{ block.super }}
    {% endwith%}
{% endblock nav_title%}

{% block css %}

{% endblock %}

{% block content %} 

<div class="container  p-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
    <h3>{{usr.get_full_name|title}} Profile</h3>
    <div class="hstack flex-wrap gap-2">
        <a href="{% url 'sub_admin_management' %}" class="btn btn-dark">Sub Admins</a>
        {% comment %} <a class="btn btn-dark">Edit Profile</a> {% endcomment %}
    </div>
  </div>

  <div class="row">
    <!-- Left Panel -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-body text-center">
          {% if usr.profile_pic %}
            <img src="{{usr.profile_pic.url}}" alt="Profile" class="rounded-circle img-fluid border border-1" style="width:120px; height:120px; object-fit:cover;">
          {% else %}
            <img src="{% static 'images/user.png' %}" class="rounded-circle mb-3" alt="Profile">
         {% endif %}
          <h5>{{usr.get_full_name|title}}</h5>
          <p class="text-muted">@{{usr.username}}</p>
          {% if usr.is_active %}
          <span class="badge bg-success">Active</span>
          {% else %}
          <span class="badge bg-warning">Deactive</span>
          {% endif %}
          <hr>

          <p><strong>Email:</strong><br> {{usr.email}}</p>
          <p><strong>Phone:</strong><br> {{usr.phone_number}}</p>
          <p><strong>Created Date:</strong><br> {{usr.date_joined|date:"m-d-Y h:i A"}}</p>
          <p>
            <strong>Last Login:</strong><br>
            {% if usr.last_login %}
              {{ usr.last_login|date:"m-d-Y h:i A" }}
            {% else %}
              Not yet
            {% endif %}
          </p>

        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="mb-3">Quick Actions</h6>
          <div class="d-grid gap-2">
             {% if usr.is_active %}
            <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#deactiveModal">Deactivate</button>
            {% else %}
             <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#activeModal">Activate</button>
             {% endif %}
            <button class="btn btn-outline-secondary">Update Profile</button>
            <button class="btn btn-outline-secondary"  data-bs-toggle="modal" data-bs-target="#passwordModal">Reset Password</button>
             <button class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#Password">Send Password</button>
          </div>

        {% comment %} deactive model {% endcomment %}
        {% if usr.is_active %}
            {% comment %} deactive model {% endcomment %}
            <div class="modal fade" id="deactiveModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Deactivation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to deactive {{athlete.username}} ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <a  href="{% url 'sub_admin_management' %}?action=deactivate&id={{usr.id}}&page={{page_number}}" class="btn btn-warning text-white">Deactive</a>
                </div>
                </div>
            </div>
            </div>
            {% else %}
                {% comment %} active modal {% endcomment %}
                <div class="modal fade" id="activeModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Confirm Activation</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to activate {{athlete.username}} ?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <a  href="{% url 'sub_admin_management' %}?action=activate&id={{usr.id}}&page={{page_number}}" class="btn btn-success">Activate</a>
                    </div>
                    </div>
                </div>
                </div>
            {% endif %}
            {% comment %}  {% endcomment %}

                 {% comment %} reset password modal {% endcomment %}
                    <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteModalLabel">Reset Password</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="col-12 my-3">
                                <label for="price" class="form-label">Password</label>
                                <input type="text" class="form-control" name="password" id="password" required>
                                <div class="text-danger">{{ form.password.errors }}</div>
                            </div>

                            <div class="col-12 my-3">
                                <label for="price" class="form-label">Confirm password</label>
                                <input type="text" class="form-control" name="confirmpassword" id="confirmpassword" required>
                                <div class="text-danger">{{ form.confirmpassword.errors }}</div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <a  href="" class="btn btn-black bg-black text-white">Submit</a>
                        </div>
                        </div>
                    </div>
                    </div>
          {% comment %}  {% endcomment %}

          {% comment %}  {% endcomment %}
            <div class="modal fade" id="Password" tabindex="-1" aria-labelledby="Password" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title">Confirm Resend Passowrd</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        When you send the new password, the player's password will be updated immediately, and they will no longer be able to log in using their
                        old password. Are you sure ?
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <a href="{% url 'resend_password' pk=usr.id %}?is_admin=True" class="btn btn-dart bg-danger text-white">Yes</a>
                    </div>
                </div>
                </div>
            </div>
            {% comment %}  {% endcomment %}
        </div>
      </div>
    </div>

    <!-- Right Panel -->
    <div class="col-md-8">
      <!-- Personal Info -->
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h6 class="mb-3">Personal Information</h6>
          <form class="row g-3">
            <div class="col-md-6">
              <label class="form-label">First Name</label>
              <input type="text" class="form-control" value="{{usr.first_name}}" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">Last Name</label>
              <input type="text" class="form-control" value="{{usr.last_name}}" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">Username</label>
              <input type="text" class="form-control" value="{{usr.username}}" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">User Role</label>
             <input type="text" class="form-control" value="{{usr.get_user_role_display|title}}" readonly>
            </div>
          </form>
        </div>
      </div>

      <!-- Permissions -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="mb-3">Permissions & Access</h6>
          <form method="post">
          {% csrf_token %}
          <div class="row">
            <div class="col-md-6">
              {% for permission in all_permissions %}
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="{{permission.id}}" name="permissions"
                {% if permission.codename in permissions %} checked {% endif %}>
                <label class="form-check-label">{{permission.name}}</label>
              </div>
              {% endfor %}
            </div>
          </div>

          <div class="d-flex gap-3 mt-3">
            <a class="btn btn-dark flex-fill" href="{% url 'event_management' %}?user-id={{usr.id}}">View Events</a>
            <button class="btn btn-secondary flex-fill">Update Permissions</button>
          </div>
          <form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock%}
